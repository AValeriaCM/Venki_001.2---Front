<ion-header>
  <ion-toolbar class="ion-toolbar-ccs">
    <ion-buttons slot="start" style="color: white;">
      <ion-button (click)="volverHome()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="tituloInfo logo">
      <ion-icon *ngIf="!searchActive" name="search-outline" class="icon-search" (click)="openSearch()"></ion-icon>
      <ion-icon *ngIf="searchActive" name="close-outline" class="icon-search" (click)="closeSearch()"></ion-icon>
      <label style="color: white;">MAGIN</label>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-searchbar *ngIf="searchActive" [value]="searhVariable" placeholder="Buscar" animated (ionChange)="buscar($event)" style="padding: 0;"></ion-searchbar>

  <ion-card *ngIf="searchActive" style="margin: 5px 0px;">

    <ion-label *ngIf="data.length > 0" class="label-results">Resultados encontrados:</ion-label>
    <ion-label *ngIf="textoBuscar && !filterList && data.length === 0" class="label-results">No se encontraron resultados</ion-label>

    <ion-list *ngIf="data.length > 0">
      <ion-item class="container friend" *ngFor="let userS of data">
        <ion-avatar slot="start">
          <img src="/assets/user.png" (click)="abrirMensajesBusqueda(userS)"/>
        </ion-avatar>
        <div class="user-list" (click)="abrirMensajesBusqueda(userS)">
          <div style="display: flex;width: 100%;">
            <ion-label color="primary" class="label-user-chat">{{userS.name}} {{userS.lastname}}</ion-label>
          </div>
        </div>
      </ion-item>
    </ion-list>
  </ion-card>

  <mat-tab-group mat-stretch-tabs class="example-stretched-tabs mat-elevation-z4" (selectedIndexChange)="selectedIndexChange($event)">
    <mat-tab>
      <ng-template mat-tab-label>
        <ion-card-title class="title-css" style="font-size: 30px;margin-top: 15px;">
          <ion-icon name="chatbubbles"></ion-icon>
        </ion-card-title>
      </ng-template>

      <ion-list style="padding: 0;">
        <ion-item *ngFor="let cont of userList | filter:filterList" class="friend">
          <ion-avatar slot="start">
            <img src="/assets/user.png" (click)="abrirDialogo(cont)" />
          </ion-avatar>
          <div class="user-list" (click)="abrirDialogo(cont)">
            <div style="display: flex;width: 100%;">
              <ion-label color="primary" class="label-user-chat">{{cont.receiver.name}} {{cont.receiver.lastname}}</ion-label>
              <ion-label *ngIf="cont.messagesReceptor.length > 0" class="label-date">{{ cont.messagesReceptor[cont.messagesReceptor.length-1].created_at | date: 'dd/MM/yyyy'}}</ion-label>
            </div>
            <ion-label *ngIf="cont.messagesReceptor.length > 0" class="label-message">{{ (cont.messagesReceptor[cont.messagesReceptor.length-1].message>50)? (cont.messagesReceptor[cont.messagesReceptor.length-1].message | slice:0:50)+'...':(cont.messagesReceptor[cont.messagesReceptor.length-1].message) }}</ion-label>
          </div>
        </ion-item>
      </ion-list>
    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <ion-card-title class="title-css" style="font-size: 30px;margin-top: 15px;">
          <ion-icon name="notifications"></ion-icon>
        </ion-card-title>
      </ng-template>
      <div class="container">
        <ion-list *ngFor="let cont of userList">
          <ion-item *ngIf="idUser == cont.transmitter.id" class="friend">
            <ion-avatar slot="start" class="author-image">
              <img class="avatar" src="../../../assets/avatar/{{cont.receiver.avatar}}.jpg" class="imagestyle" (click)="verUser(cont.receiver)">
            </ion-avatar>
            <p class="user-list" (click)="verUser(cont.receiver)">
              <strong>Agregaste a <span style="color: black; font-size: 15px;text-transform:capitalize;">{{cont.receiver.name}}&nbsp;{{cont.receiver.lastname}}</span> como amigo.</strong>
            </p>
          </ion-item>
          <ion-item *ngIf="idUser !== cont.transmitter.id" class="friend">
            <ion-avatar slot="start" class="author-image">
              <img class="avatar" src="../../../assets/avatar/{{cont.transmitter.avatar}}.jpg" class="imagestyle" (click)="verUser(cont.transmitter)"/>
            </ion-avatar>
            <p class="user-list" (click)="verUser(cont.transmitter)">
              <strong>El usuario <span style="color: black; font-size: 15px;text-transform:capitalize;">{{cont.transmitter.name}}&nbsp;{{cont.transmitter.lastname}}</span> te ha agregado como amigo. </strong>
            </p>
          </ion-item>
          <ion-item *ngIf="idUser !== cont.transmitter.id" class="friend">
            <ion-avatar slot="start" class="author-image">
              <img class="avatar" src="../../../assets/avatar/{{cont.transmitter.avatar}}.jpg" class="imagestyle" (click)="verUser(cont.transmitter)"/>
            </ion-avatar>
            <p class="user-list" (click)="verUser(cont.transmitter)">
              <strong>El usuario <span style="color: black; font-size: 15px;text-transform:capitalize;">{{cont.transmitter.name}}&nbsp;{{cont.transmitter.lastname}}</span> te ha enviado un mensaje. </strong>
            </p>
          </ion-item>
        </ion-list>
      </div>
    </mat-tab>
  </mat-tab-group>

</ion-content>