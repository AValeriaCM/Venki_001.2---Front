<ion-header #header>
  <ion-toolbar #toolbar class="ion-toolbar-ccs">
    <div>
      <ion-toolbar>
        <ion-row class="logo">
          <ion-col size="4">
            <div class="icon-header">
              <img src="/assets/finallogo.png" width="120" height="70">
            </div>
          </ion-col>
          <ion-col size="8" style="align-self: flex-end">
            <div class="info-header">
              <ion-label *ngIf="usertk" style="font-size: 14px;color: #fff;margin-right: 5px;">{{ message_header }}</ion-label>
              <ion-label *ngIf="usertk" style="font-size: 14px;color: #fff;text-transform: capitalize;">{{usertk.name}}</ion-label>
            </div>
          </ion-col>
        </ion-row>
      </ion-toolbar>
    </div>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" [appHideHeader]="header" [scrollEvents]="true" slot="start" id="ion-content-opcional">
  <div class="divBack">
    <div *ngIf="usertk !== null">
      <ion-grid class="profile-intro">
        <ion-row>
          <ion-col size="4" style="padding-bottom: 0px;">
            <img class="profile-photo" src="../../../assets/avatar/{{usertk.avatar}}.png" (click)="CreatePopover()">
          </ion-col>
          <ion-col size="8" style="align-self: center;">
            <ion-label color="primary" class="logout" (click)="logout()">Cerrar Sesión</ion-label>
            <!--<ion-label color="primary" class="logout" (click)="abrirDialogo()">Modificar información</ion-label>-->
            <div>
              <div class="info-square">
                <p class="user-name">
                  <strong>
                    <ion-label (click)="abrirDialogo()">{{usertk.name}} {{usertk.lastname}}</ion-label>
                  </strong>
                </p>
                <ion-label *ngIf="profileUser" (click)="categoryRedirect()" style="font-size: 12px;
                letter-spacing: 1px;
                color: #ffffff;
                font-weight: bold;
                background: #002a68;
                padding: 7px;
                border-radius: 5px;
                white-space: break-spaces;">{{ profileUser }}</ion-label>
              </div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>

      <mat-tab-group mat-stretch-tabs class="expand-css mat-elevation-z4" (selectedTabChange)="eventchangeTab($event)">
        <mat-tab>
          <ng-template mat-tab-label>
            <ion-icon name="grid" class="larger"></ion-icon>
          </ng-template>
          <mat-tab-group mat-stretch-tabs class="expand-css2 mat-elevation-z4">
            <mat-tab>
              <ng-template mat-tab-label>
                <ion-card-title class="title-css2" style="text-align: center;">Mi Información</ion-card-title>
              </ng-template>
              <!--form-edit-->
              <div *ngIf="usertk">
                <form [formGroup]="editarForm">
                  <ion-item>
                    <ion-icon name="person" style="color:  #002a68"></ion-icon>
                    <ion-input class="Subtitle-css" clearInput name="nombre" type="text" placeholder="Nombre" formControlName="name">
                    </ion-input>
                  </ion-item>
                  <ion-item class='form-text-error' *ngIf="!editarForm.controls.name.valid && (editarForm.controls.name.touched || editarForm.controls.name.dirty)">
                    <ion-label class="label-error">El nombre debe tener mínimo 5 caracteres</ion-label>
                  </ion-item>
                  <ion-item> 
                    <ion-icon name="person" style="color:  #002a68"></ion-icon>
                    <ion-input class="Subtitle-css" clearInput name="apellido" type="text" placeholder="Apellido" formControlName="lastname"></ion-input>
                  </ion-item>
                  <ion-item class='form-text-error' *ngIf="!editarForm.controls.lastname.valid && (editarForm.controls.lastname.touched || editarForm.controls.lastname.dirty)">
                    <ion-label class="label-error">El apellido debe tener mínimo 5 caracteres</ion-label>
                  </ion-item>
                  <ion-item class="itemDec ion-item-css">
                    <ion-icon name="call" style="color:  #002a68"></ion-icon>
                    <ion-input name="celular" type="text" clearInput placeholder="Teléfono" formControlName="phone"></ion-input>
                  </ion-item>
                  <ion-item class='form-text-error' *ngIf="!editarForm.controls.phone.valid && (editarForm.controls.phone.touched || editarForm.controls.phone.dirty)">
                    <ion-label class="Subtitle-css" class="label-error">El teléfono supera el mínimo de caracteres permitido</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-icon name="calendar" style="color:  #002a68"></ion-icon>
                    <ion-datetime class="Subtitle-css" clearInput placeholder="Fecha de Nacimiento"
                      displayFormat="YYYY/MM/DD" min="1980" max="2005" formControlName="birthday" cancelText="Cancelar" doneText="Hecho" style="width: 100%;"></ion-datetime>
                  </ion-item>
                  <ion-item>
                    <ion-icon name="chatbubble-ellipses" class="iconDesc" style="color:  #002a68"></ion-icon> &nbsp;
                    <ion-textarea formControlName="description" clearInput [disabled]="false" rows="5" class="Subtitle-cs-desc">Descripción</ion-textarea>
                  </ion-item>
                  <ion-item>
                    <ion-icon name="school" class="iconDesc" style="color:  #002a68"></ion-icon> &nbsp;
                    <ion-input class="Subtitle-css" clearInput name="institution" type="text" placeholder="¿Dónde estudiaste?" formControlName="institution"></ion-input>
                  </ion-item>
                  <ion-item class='form-text-error' *ngIf="!editarForm.controls.institution.valid && (editarForm.controls.institution.touched || editarForm.controls.institution.dirty)">
                    <ion-label class="label-error">La institución es incorrecta.</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-icon name="heart-circle" style="color:  #002a68"></ion-icon> &nbsp;                        
                    <ion-select class="ion-select Subtitle-css" formControlName="status">
                      <ion-select-option value="{{ it.situacion }}" *ngFor="let it of items">
                        {{it.situacion}}
                      </ion-select-option>
                    </ion-select>
                  </ion-item>
                  <ion-item>
                    <ion-icon name="location" style="color:  #002a68"></ion-icon> &nbsp;
                    <ion-input class="Subtitle-css" clearInput name="city" type="text" placeholder="Dónde vives?" formControlName="city"></ion-input>
                  </ion-item>
                  <div style="margin-top: 15px;text-align: -webkit-center;"> 
                    <ion-button type="submit" (click)="editar()" [disabled]="!editarForm.valid" expand="block" style="margin: 0;width: 50%;--background: #002a68;">Editar</ion-button>
                  </div>
                </form>
              </div>
            </mat-tab>
            <mat-tab style="height:500px;">
              <ng-template mat-tab-label>
                <ion-card-title class="title-css2" style="text-align: center;">Mi Competencia</ion-card-title>
              </ng-template>

              <div style="padding: 10px 25px;">
                <ion-card class="competence-sport" (click)="createCompetition(1)">
                  <ion-card-content style="height: 100%;top: 35%;">
                    <div>
                      <ion-label class="label-competence">DEPORTIVO</ion-label>
                    </div>
                  </ion-card-content>
                </ion-card>
  
                <ion-card class="competence-academic" (click)="createCompetition(2)">
                  <ion-card-content style="height: 100%;top: 35%;">
                    <div>
                      <ion-label class="label-competence">ACADÉMICO</ion-label>
                    </div>
                  </ion-card-content>
                </ion-card>
              </div>
            </mat-tab>
          </mat-tab-group>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <ion-icon name="bookmark" class="larger"></ion-icon>
          </ng-template>

          <div>
            <div *ngIf="usertk.email !== null">

              <ion-card-title class="title-css" style="font-size: 20px; text-align: center;">MI DESARROLLO</ion-card-title>

              <mat-accordion>
                <mat-expansion-panel class="expacionCss">
                  <mat-expansion-panel-header class="expacionCss">
                    <mat-panel-title>
                      <label class="Subtitle-css-expansive">TROFEOS E INSIGNIAS</label>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <ion-row style="border-bottom: groove;" *ngIf="trofeosInsig.length > 0">
                    <ion-col col-4>
                      <ion-label class="title-cssCursos">Trofeos</ion-label>
                    </ion-col>
                    <ion-col col-4>
                      <ion-label class="title-cssCursos">Insignias</ion-label>
                    </ion-col>
                  </ion-row>
                  <template *ngIf="trofeosInsig.length > 0">
                    <ion-row style="border-bottom: groove;" *ngFor="let tyi of trofeosInsig">
                      <ion-col col-4>
                        <ion-label class="title-cssCursos">{{tyi.trofeo}}</ion-label>
                      </ion-col>
                      <ion-col col-4>
                        <img style="margin-left: 24px;" src="{{tyi.insignia}}">
                      </ion-col>
                    </ion-row>
                  </template>
                  <ion-row *ngIf="trofeosInsig.length === 0" style="justify-content: center;">
                    <ion-badge color="warning">No cuentas con trofeos e insignias</ion-badge>
                  </ion-row>

                </mat-expansion-panel>
              </mat-accordion>

              <ion-card-title class="title-css" style="font-size: 20px; text-align: center;">MIS CURSOS</ion-card-title>

              <mat-tab-group mat-stretch-tabs class="expand-css2 mat-elevation-z4">
                <mat-tab>
                  <ng-template mat-tab-label>
                    <ion-card-title class="title-css2" style="text-align: center;">CURSANDO</ion-card-title>
                  </ng-template>
                  <ion-list *ngIf="coursesProgress.length > 0">
                    <div *ngFor="let curso of coursesProgress">
                      <div *ngIf="curso.pivot.progress != 1">
                        <ion-item class="ion-item-css">
                          <ion-avatar slot="start">
                            <img src="{{basePath}}{{curso.photo}}" (click)="verCurso()">
                          </ion-avatar>
                          <ion-label class="Subtitle-css" (click)="verCurso()" style="font-size: 12px;">{{curso.name}}</ion-label>
                          <div>
                            <ion-list-header style="padding: 0;">
                              <h5 style="margin: 0;">Progreso: <span>{{curso.pivot.progress*100}}%</span></h5>
                            </ion-list-header>
                            <ion-progress-bar [value]="curso.pivot.progress" color="primary"></ion-progress-bar>
                          </div>
                        </ion-item>
                      </div>
                    </div>
                  </ion-list>
                  <ion-row *ngIf="coursesProgress.length === 0" style="padding: 10px;place-content: center;">
                    <ion-badge color="warning">No tienes cursos actualmente</ion-badge>
                  </ion-row>
                </mat-tab>
                <mat-tab>
                  <ng-template mat-tab-label>
                    <ion-card-title class="title-css2" style="text-align: center;">COMPLETADO</ion-card-title>
                  </ng-template>
                  <ion-list *ngIf="coursesCompleted.length > 0">
                    <div *ngFor="let curso of coursesCompleted">
                      <div *ngIf="curso.pivot.progress == 1">
                        <ion-item class="ion-item-css">
                          <ion-avatar slot="start">
                            <img src="{{basePath}}{{curso.photo}}" (click)="verCurso()">
                          </ion-avatar>
                          <ion-label class="Subtitle-css" (click)="verCurso()" style="font-size: 12px;">{{ curso.name }}</ion-label>
                          <div>
                            <ion-list-header style="padding: 0;">
                              <h5 style="margin: 0;">Progreso: <span>{{curso.pivot.progress*100}}%</span></h5>
                            </ion-list-header>
                            <ion-progress-bar [value]="curso.pivot.progress" color="primary"></ion-progress-bar>
                          </div>
                        </ion-item>
                      </div>
                    </div>
                  </ion-list>
                  <ion-row *ngIf="coursesCompleted.length === 0" style="padding: 10px;place-content: center;">
                    <ion-badge color="warning">No tienes cursos finalizados</ion-badge>
                  </ion-row>
                </mat-tab>
              </mat-tab-group>
            </div>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <ion-icon name="settings" class="larger"></ion-icon>
          </ng-template>
          <ion-grid style="padding: 0;">
            <ion-list no-lines>
              <ion-item lines="none">
                <ion-label>
                  <ion-button class="button-css-options" fill="clear" expand="block"
                    (click)="activityRedirect()">
                    <ion-icon name="chatbox-outline"></ion-icon>&nbsp;
                    Mi actividad
                  </ion-button>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <ion-button [disabled]="usertk.premium === 0" class="button-css-options" fill="clear" expand="block"
                    (click)="miCalendario()">
                    <ion-icon name="calendar-outline"></ion-icon>&nbsp;
                    Calendario
                  </ion-button>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <ion-button class="button-css-options" fill="clear" expand="block" (click)="miTimeLine()">
                    <ion-icon name="hourglass-outline"></ion-icon>&nbsp;
                    TimeLine
                  </ion-button>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <ion-button class="button-css-options" fill="clear" expand="block"
                    (click)="misEstadisticas()">
                    <ion-icon name="bar-chart-outline"></ion-icon>&nbsp;
                    Metricas
                  </ion-button>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <ion-button class="button-css-options" fill="clear" expand="block" (click)="MisObjetivos(usertk.id)">
                    <ion-icon name="trophy-outline"></ion-icon>&nbsp;
                    Mis Objetivos
                  </ion-button>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <ion-button [disabled]="usertk.surveyed  === 1" class="button-css-options" fill="clear" expand="block"
                    (click)="diagnosticoRedirect(usertk.profile.id,  usertk.id)">
                    <ion-icon name="fitness-outline"></ion-icon>&nbsp;
                    Diagnostico
                  </ion-button>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <ion-button class="button-css-options" fill="clear" expand="block" (click)="categoryRedirect()">
                    <ion-icon name="rocket-outline"></ion-icon>&nbsp;
                    Categoría
                  </ion-button>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-grid>

          <ion-row style="padding: 10px;place-content: center;">
            <ion-button class="button-css-options" shape="round" (click)="logout()" style="width: 60%;">
              Cerrar Sesión
              <ion-icon name="key" style="margin-left: 5px;"></ion-icon>
            </ion-button>
          </ion-row>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>

  <div *ngIf="usertk !== null">
    <ion-card *ngIf="usertk.email == 'usuarioN@hotmail.com'">
      <ion-card-content>
        <ion-item>
          <ion-avatar slot="start">
            <img
              src="https://happytravel.viajes/wp-content/uploads/2020/04/146-1468479_my-profile-icon-blank-profile-picture-circle-hd.png"
              (click)="abrirDialogo()">
          </ion-avatar>
          <ion-label>{{usertk.name}}</ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>
  <br>



</ion-content>